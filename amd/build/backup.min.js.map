{"version":3,"file":"backup.min.js","sources":["../src/backup.js"],"sourcesContent":["import Ajax from 'core/ajax';\n\n/**\n * Get import restrictions to exclude templated items.\n */\nexport const getImportRestrictions = () => {\n    let args = [];\n    const request = {\n        methodname: 'local_solent_get_import_restrictions',\n        args: args\n    };\n\n    Ajax.call([request])[0].done(restrictactivitybackup);\n};\n\n/**\n * Restrict specified items\n * @param {array} data The data returned by getImportRestrictions.\n */\nconst restrictactivitybackup = (data) => {\n    const biform = document.querySelector('#page-backup-import div[role=\"main\"] form');\n    if (!biform.stage) {\n        return;\n    }\n    const stage = biform.stage.value;\n    const jumpto = document.querySelector('[name=\"oneclickbackup\"]');\n    const legacy = document.querySelector('[name=\"setting_root_legacyfiles\"]');\n    // Remove \"Jump to final step\" button.\n    if (jumpto) {\n        jumpto.style.display = 'none';\n        jumpto.setAttribute('disabled', true);\n    }\n    // Make sure Legacy files are not imported.\n    if (legacy) {\n        legacy.removeAttribute(\"checked\");\n        legacy.setAttribute(\"disabled\", true);\n        legacy.value = 0;\n    }\n    if (!data) {\n        return;\n    }\n    if (stage != 2) {\n        return;\n    }\n\n    let checkboxes = biform.querySelectorAll('input[type=\"checkbox\"]');\n    checkboxes.forEach(checkbox => {\n        let name = checkbox.name;\n        let label = checkbox.parentNode.textContent\n            .replaceAll('\\u00a0', ' ') // Non-breaking space.\n            .replaceAll('\\n', ' ');\n        data.forEach((item) => {\n            if (item.activity && item.title) {\n                if ((name.search(new RegExp('activity_' + item.activity + '[0-9a-z_]+included')) != -1)\n                    && (label.search(item.title) != -1)) {\n                    checkbox.setAttribute(\"checked\", false);\n                    checkbox.setAttribute(\"disabled\", true);\n                }\n                return;\n            }\n            if (item.activity) {\n                if (name.search(new RegExp('activity_' + item.activity + '[0-9a-z_]+included')) != -1) {\n                    checkbox.setAttribute(\"checked\", false);\n                    checkbox.setAttribute(\"disabled\", true);\n                }\n                return;\n            }\n            if (item.title) {\n                if (label.search(item.title) != -1) {\n                    checkbox.setAttribute(\"checked\", false);\n                    checkbox.setAttribute(\"disabled\", true);\n                    // Let's also disable the user's info bit.\n                    // data.splice(key, 1); // Reduce the number of items to loop through as this one is done.\n                }\n                return;\n            }\n        });\n    });\n};\n"],"names":["request","methodname","args","call","done","restrictactivitybackup","data","biform","document","querySelector","stage","value","jumpto","legacy","style","display","setAttribute","removeAttribute","querySelectorAll","forEach","checkbox","name","label","parentNode","textContent","replaceAll","item","activity","title","search","RegExp"],"mappings":"wQAKqC,WAE3BA,QAAU,CACZC,WAAY,uCACZC,KAHO,kBAMNC,KAAK,CAACH,UAAU,GAAGI,KAAKC,+BAO3BA,uBAA0BC,aACtBC,OAASC,SAASC,cAAc,iDACjCF,OAAOG,mBAGNA,MAAQH,OAAOG,MAAMC,MACrBC,OAASJ,SAASC,cAAc,2BAChCI,OAASL,SAASC,cAAc,wCAElCG,SACAA,OAAOE,MAAMC,QAAU,OACvBH,OAAOI,aAAa,YAAY,IAGhCH,SACAA,OAAOI,gBAAgB,WACvBJ,OAAOG,aAAa,YAAY,GAChCH,OAAOF,MAAQ,IAEdL,eAGQ,GAATI,aAIaH,OAAOW,iBAAiB,0BAC9BC,SAAQC,eACXC,KAAOD,SAASC,KAChBC,MAAQF,SAASG,WAAWC,YAC3BC,WAAW,IAAU,KACrBA,WAAW,KAAM,KACtBnB,KAAKa,SAASO,OACNA,KAAKC,UAAYD,KAAKE,OAC+D,GAAhFP,KAAKQ,OAAO,IAAIC,OAAO,YAAcJ,KAAKC,SAAW,yBACrB,GAA7BL,MAAMO,OAAOH,KAAKE,SACtBR,SAASJ,aAAa,WAAW,GACjCI,SAASJ,aAAa,YAAY,IAItCU,KAAKC,UAC+E,GAAhFN,KAAKQ,OAAO,IAAIC,OAAO,YAAcJ,KAAKC,SAAW,yBACrDP,SAASJ,aAAa,WAAW,GACjCI,SAASJ,aAAa,YAAY,IAItCU,KAAKE,QAC4B,GAA7BN,MAAMO,OAAOH,KAAKE,SAClBR,SAASJ,aAAa,WAAW,GACjCI,SAASJ,aAAa,YAAY"}