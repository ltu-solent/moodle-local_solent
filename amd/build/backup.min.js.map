{"version":3,"file":"backup.min.js","sources":["../src/backup.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Competency picker.\n *\n * To handle 'save' events use: picker.on('save')\n * This will receive a object with either a single 'competencyId', or an array in 'competencyIds'\n * depending on the value of multiSelect.\n *\n * @module     local_solent/backup\n * @copyright  2024 Solent University\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Ajax from 'core/ajax';\nimport Pending from 'core/pending';\nimport Notification from 'core/notification';\n\n/**\n * Get import restrictions to exclude templated items.\n * @return {object}\n */\nexport const getImportRestrictions = () => {\n    let args = [];\n    const request = {\n        methodname: 'local_solent_get_import_restrictions',\n        args: args\n    };\n    const pendingPromise = new Pending('local/solent:getImportRestrictions');\n    Ajax.call([request])[0]\n        .then(restrictactivitybackup)\n        .catch(Notification.exception);\n    return pendingPromise.resolve();\n};\n\n/**\n * Restrict specified items\n * @param {array} data The data returned by getImportRestrictions.\n */\nconst restrictactivitybackup = (data) => {\n    const biform = document.querySelector('#page-backup-import div[role=\"main\"] form');\n    if (!biform.stage) {\n        return;\n    }\n    const stage = biform.stage.value;\n    const jumpto = document.querySelector('[name=\"oneclickbackup\"]');\n    const legacy = document.querySelector('[name=\"setting_root_legacyfiles\"]');\n    // Remove \"Jump to final step\" button.\n    if (jumpto) {\n        jumpto.style.display = 'none';\n        jumpto.setAttribute('disabled', true);\n    }\n    // Make sure Legacy files are not imported.\n    if (legacy) {\n        legacy.removeAttribute(\"checked\");\n        legacy.setAttribute(\"disabled\", true);\n        legacy.value = 0;\n    }\n    if (!data) {\n        return;\n    }\n    if (stage != 2) {\n        return;\n    }\n\n    let checkboxes = biform.querySelectorAll('input[type=\"checkbox\"]');\n    checkboxes.forEach(checkbox => {\n        let name = checkbox.name;\n        let label = checkbox.parentNode.textContent\n            .replaceAll('\\u00a0', ' ') // Non-breaking space.\n            .replaceAll('\\n', ' ');\n        data.forEach((item) => {\n            if (item.activity && item.title) {\n                if ((name.search(new RegExp('activity_' + item.activity + '[0-9a-z_]+included')) != -1)\n                    && (label.search(item.title) != -1)) {\n                    checkbox.setAttribute(\"checked\", false);\n                    checkbox.setAttribute(\"disabled\", true);\n                }\n                return;\n            }\n            if (item.activity) {\n                if (name.search(new RegExp('activity_' + item.activity + '[0-9a-z_]+included')) != -1) {\n                    checkbox.setAttribute(\"checked\", false);\n                    checkbox.setAttribute(\"disabled\", true);\n                }\n                return;\n            }\n            if (item.title) {\n                if (label.search(item.title) != -1) {\n                    checkbox.setAttribute(\"checked\", false);\n                    checkbox.setAttribute(\"disabled\", true);\n                    // Let's also disable the user's info bit.\n                    // data.splice(key, 1); // Reduce the number of items to loop through as this one is done.\n                }\n                return;\n            }\n        });\n    });\n};\n"],"names":["request","methodname","args","pendingPromise","Pending","call","then","restrictactivitybackup","catch","Notification","exception","resolve","data","biform","document","querySelector","stage","value","jumpto","legacy","style","display","setAttribute","removeAttribute","querySelectorAll","forEach","checkbox","name","label","parentNode","textContent","replaceAll","item","activity","title","search","RegExp"],"mappings":";;;;;;;;;;;oQAkCqC,WAE3BA,QAAU,CACZC,WAAY,uCACZC,KAHO,IAKLC,eAAiB,IAAIC,iBAAQ,2DAC9BC,KAAK,CAACL,UAAU,GAChBM,KAAKC,wBACLC,MAAMC,sBAAaC,WACjBP,eAAeQ,iBAOpBJ,uBAA0BK,aACtBC,OAASC,SAASC,cAAc,iDACjCF,OAAOG,mBAGNA,MAAQH,OAAOG,MAAMC,MACrBC,OAASJ,SAASC,cAAc,2BAChCI,OAASL,SAASC,cAAc,wCAElCG,SACAA,OAAOE,MAAMC,QAAU,OACvBH,OAAOI,aAAa,YAAY,IAGhCH,SACAA,OAAOI,gBAAgB,WACvBJ,OAAOG,aAAa,YAAY,GAChCH,OAAOF,MAAQ,IAEdL,eAGQ,GAATI,aAIaH,OAAOW,iBAAiB,0BAC9BC,SAAQC,eACXC,KAAOD,SAASC,KAChBC,MAAQF,SAASG,WAAWC,YAC3BC,WAAW,IAAU,KACrBA,WAAW,KAAM,KACtBnB,KAAKa,SAASO,OACNA,KAAKC,UAAYD,KAAKE,OAC+D,GAAhFP,KAAKQ,OAAO,IAAIC,OAAO,YAAcJ,KAAKC,SAAW,yBACrB,GAA7BL,MAAMO,OAAOH,KAAKE,SACtBR,SAASJ,aAAa,WAAW,GACjCI,SAASJ,aAAa,YAAY,IAItCU,KAAKC,UAC+E,GAAhFN,KAAKQ,OAAO,IAAIC,OAAO,YAAcJ,KAAKC,SAAW,yBACrDP,SAASJ,aAAa,WAAW,GACjCI,SAASJ,aAAa,YAAY,IAItCU,KAAKE,QAC4B,GAA7BN,MAAMO,OAAOH,KAAKE,SAClBR,SAASJ,aAAa,WAAW,GACjCI,SAASJ,aAAa,YAAY"}